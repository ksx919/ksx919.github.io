"use strict";(self["webpackChunkaihub"]=self["webpackChunkaihub"]||[]).push([[641],{6641:function(e,t,a){a.r(t),a.d(t,{default:function(){return $}});var n=a(6768),s=a(4232),l=a(5130);const i={class:"chat-ai-layout"},u={class:"sidebar"},c={class:"chat-list"},r=["onClick"],o={class:"chat-summary"},v={class:"chat-time"},h={class:"chat-main"},d=["title"],k={class:"chat-window"},g={class:"messages"},p={class:"message-avatar"},m={key:0,class:"user-avatar"},f={key:1,class:"ai-avatar"},y={class:"message-content"},C={key:0,class:"user-message"},w={class:"text"},L={key:1,class:"ai-message-container"},b={key:0,class:"ai-think"},x=["onClick"],T={class:"think-toggle"},K={key:0,class:"thinking-dot"},I={key:1,class:"loading-dots"},R={key:2,class:"ai-response"},E=["innerHTML"],S={class:"input-bar"},X={class:"input-wrapper"},H=["disabled"],_={class:"input-actions"},A=["disabled"],M={key:0},D={key:1};function z(e,t,a,z,Q,F){return(0,n.uX)(),(0,n.CE)("div",i,[(0,n.Lk)("aside",u,[t[6]||(t[6]=(0,n.Lk)("div",{class:"sidebar-header"},[(0,n.Lk)("h2",null,"AI聊天"),(0,n.Lk)("p",{class:"subtitle"},"智能对话助手")],-1)),(0,n.Lk)("div",c,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(z.chatList,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.chatId,class:(0,s.C4)(["chat-item",e.chatId===z.currentChatId?"active":""]),onClick:t=>z.switchChat(e.chatId)},[(0,n.Lk)("div",o,(0,s.v_)(e.summary||"（空会话）"),1),(0,n.Lk)("div",v,(0,s.v_)(z.formatTime(e.createTime)),1)],10,r))),128))]),(0,n.Lk)("button",{class:"new-chat-btn",onClick:t[0]||(t[0]=(...e)=>z.newChat&&z.newChat(...e))},"+ 新建会话")]),(0,n.Lk)("main",h,[(0,n.Lk)("div",{class:(0,s.C4)(["chat-header",{collapsed:z.isHeaderCollapsed}])},[t[7]||(t[7]=(0,n.Fv)('<div class="header-content" data-v-01f43648><h1 data-v-01f43648>AI聊天助手</h1><div class="features" data-v-01f43648><span class="feature-tag" data-v-01f43648>智能对话</span><span class="feature-tag" data-v-01f43648>知识问答</span><span class="feature-tag" data-v-01f43648>深度思考</span><span class="feature-tag" data-v-01f43648>创意写作</span></div></div>',1)),(0,n.Lk)("button",{class:"collapse-btn",onClick:t[1]||(t[1]=(...e)=>z.toggleHeader&&z.toggleHeader(...e)),title:z.isHeaderCollapsed?"展开标题":"收起标题"},(0,s.v_)(z.isHeaderCollapsed?"▼":"▲"),9,d)],2),(0,n.Lk)("div",k,[(0,n.Lk)("div",g,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(z.currentMessages,(e,a)=>((0,n.uX)(),(0,n.CE)("div",{key:a,class:(0,s.C4)(["message",e.role])},[(0,n.Lk)("div",p,["user"===e.role?((0,n.uX)(),(0,n.CE)("div",m,"👤")):((0,n.uX)(),(0,n.CE)("div",f,"🤖"))]),(0,n.Lk)("div",y,["user"===e.role?((0,n.uX)(),(0,n.CE)("div",C,[(0,n.Lk)("span",w,(0,s.v_)(e.text),1)])):((0,n.uX)(),(0,n.CE)("div",L,[e.think?((0,n.uX)(),(0,n.CE)("div",b,[(0,n.Lk)("div",{class:"ai-think-header",onClick:e=>z.toggleThink(a)},[(0,n.Lk)("span",T,(0,s.v_)(z.thinkStates[a]?"▼":"▶"),1),(0,n.eW)(" "+(0,s.v_)(z.isThinking&&a===z.currentMessages.length-1&&z.loading?"思考中":"思考过程")+" ",1),z.isThinking&&a===z.currentMessages.length-1&&z.loading?((0,n.uX)(),(0,n.CE)("span",K)):(0,n.Q3)("",!0)],8,x),(0,n.bo)((0,n.Lk)("div",{class:"ai-think-content"},(0,s.v_)(e.think),513),[[l.aG,!1!==z.thinkStates[a]]])])):(0,n.Q3)("",!0),!z.loading||a!==z.currentMessages.length-1||e.text||e.think?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",I,t[8]||(t[8]=[(0,n.Lk)("span",{class:"dot"},null,-1),(0,n.Lk)("span",{class:"dot"},null,-1),(0,n.Lk)("span",{class:"dot"},null,-1)]))),e.text?((0,n.uX)(),(0,n.CE)("div",R,[(0,n.Lk)("div",{class:"response-text",innerHTML:z.formatResponse(e.text)},null,8,E)])):(0,n.Q3)("",!0)]))])],2))),128))]),(0,n.Lk)("div",S,[(0,n.Lk)("div",X,[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>z.input=e),onInput:t[3]||(t[3]=(...e)=>z.autoResizeInput&&z.autoResizeInput(...e)),onKeydown:t[4]||(t[4]=(...e)=>z.handleKeydown&&z.handleKeydown(...e)),placeholder:"请输入您的问题或想法...",disabled:z.loading,class:"input-auto textarea-auto",rows:"1",style:{resize:"none",overflow:"hidden"}},null,40,H),[[l.Jo,z.input]]),(0,n.Lk)("div",_,[(0,n.Lk)("button",{class:"send-btn",onClick:t[5]||(t[5]=(...e)=>z.send&&z.send(...e)),disabled:z.loading||!z.input.trim()},[z.loading?((0,n.uX)(),(0,n.CE)("span",M,"发送中...")):((0,n.uX)(),(0,n.CE)("span",D,"发送"))],8,A)])])])])])])}a(4114),a(8111),a(116),a(7588),a(1701);var Q=a(144),F=a(4373);function O(){return"chat_"+Date.now()+"_"+Math.random().toString(36).slice(2,8)}var G={name:"ChatAI",setup(){const e=(0,Q.KR)([]),t=(0,Q.KR)(""),a=(0,Q.KR)(""),s=(0,Q.KR)(!1),l=(0,Q.KR)(""),i=(0,Q.KR)({}),u=(0,Q.KR)(!1),c=(0,Q.KR)(""),r=(0,Q.KR)(!0),o=(0,Q.KR)(!1),v=(0,Q.KR)([]),h=(0,Q.KR)(!1),d=(0,Q.KR)({}),k=(0,Q.KR)({}),g=(0,Q.KR)({}),p=(0,Q.KR)({}),m=async()=>{try{const n=await F.A.get("/ai/history/chat/with-time"),s=n.data,l=[];for(const[e,t]of Object.entries(s))try{const a=await F.A.get(`/ai/history/chat/${e}`),n=a.data;let s="（空会话）";const i=n.find(e=>"user"===e.role);i&&i.content&&(s=i.content.slice(0,20)+(i.content.length>20?"...":"")),l.push({chatId:e,summary:s,createTime:t})}catch(a){l.push({chatId:e,summary:"（空会话）",createTime:t})}l.sort((e,t)=>t.createTime-e.createTime),e.value=l,e.value.length>0&&!t.value&&(t.value=e.value[0].chatId)}catch(a){console.error("获取会话列表失败:",a)}},f=async e=>{if(!e)return;const a=await F.A.get(`/ai/history/chat/${e}`),n=a.data.map(e=>{if("assistant"===e.role&&e.content&&e.content.includes("<think>")){const t=e.content.match(/<think>([\s\S]*?)<\/think>/);return{role:"ai",text:e.content.replace(/<think>[\s\S]*?<\/think>/,"").trim(),think:t?t[1].trim():""}}return"assistant"===e.role?{role:"ai",text:e.content,think:""}:{role:"user",text:e.content}});if(d.value[e]=n,e===t.value){v.value=n;const t={};n.forEach((e,a)=>{e.think&&(t[a]=!0)}),p.value[e]=t,i.value=t,w()}},y=async()=>{const e=O();t.value=e,d.value[e]=[],v.value=[]},C=async e=>{if(t.value=e,d.value[e]){v.value=d.value[e],i.value=p.value[e]||{};const t=k.value[e]&&g.value[e]&&g.value[e].includes("<think>")&&!g.value[e].includes("</think>");u.value=t,l.value=g.value[e]||"",w()}else await f(e),u.value=!1,l.value=""},w=()=>{setTimeout(()=>{const e=document.querySelector(".messages");e&&(e.scrollTop=e.scrollHeight)},10)},L=()=>{h.value=!h.value},b=e=>{if(e){const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()}return""},x=e=>e?e.replace(/\n/g,"<br>"):"",T=async()=>{if(!a.value.trim()||s.value)return;const n=t.value;if(!n){const e=O();t.value=e,d.value[e]=[]}const l=a.value;a.value="",k.value[t.value]=!0,s.value=!0;let i=d.value[t.value]||[];if(0===i.length){const a=Date.now();e.value.unshift({chatId:t.value,summary:l.slice(0,20)+(l.length>20?"...":""),createTime:a})}else{const a=e.value.find(e=>e.chatId===t.value);a&&(a.createTime=Date.now())}i.push({role:"user",text:l}),d.value[t.value]=i,i.push({role:"ai",text:"",think:""}),d.value[t.value]=i,t.value===t.value&&(v.value=i,w()),K(t.value,l,i)},K=async(e,a,n)=>{try{const s=F.A.getUri({url:"/ai/chat",params:{prompt:a,chatId:e}}),i=await fetch(s,{method:"GET"});if(!i.body)throw new Error("无流式响应");const c=i.body.getReader();let r="",o=!1,h=!1;g.value[e]="",p.value[e]=p.value[e]||{};const k=n.length-1;p.value[e][k]=!0,e===t.value&&(v.value=n,w());while(1){const{done:a,value:s}=await c.read();if(a)break;const i=new TextDecoder("utf-8").decode(s);if(r+=i,g.value[e]=r,!r.includes("<think>")||o||h)if(o&&r.includes("</think>")){o=!1,h=!0;const e=r.match(/<think>([\s\S]*?)<\/think>/);e&&(n[k].think=e[1].trim());let t=r.split(/<think>[\s\S]*?<\/think>/)[1]||"";t=t.replace(/<think>|<\/think>/g,"").trim(),t=t.replace(/\n\s*\n/g,"\n").trim(),n[k].text=t}else if(o&&!h){const e=r.indexOf("<think>")+7,t=r.substring(e).trim();n[k].think=t,n[k].text=""}else if(r.includes("<think>")&&r.includes("</think>")){let e=r.split(/<think>[\s\S]*?<\/think>/)[1]||"";e=e.replace(/<think>|<\/think>/g,"").trim(),e=e.replace(/\n\s*\n/g,"\n").trim(),n[k].text=e}else{let e=r.replace(/<think>[\s\S]*?<\/think>/g,"").trim();e=e.replace(/<think>|<\/think>/g,"").trim(),e=e.replace(/\n\s*\n/g,"\n").trim(),n[k].text=e}else{o=!0;const e=r.indexOf("<think>")+7,t=r.substring(e).trim();n[k].think=t,n[k].text=""}d.value[e]=[...n],e===t.value&&(v.value=[...n],u.value=o&&!h,l.value=r,w())}let f="",y=r;const C=r.match(/<think>([\s\S]*?)<\/think>/);if(C){f=C[1].trim();const e=r.split(/<think>[\s\S]*?<\/think>/)[1];y=e?e.trim():""}else y=r.trim();y=y.replace(/<think>|<\/think>/g,"").trim(),y=y.replace(/\n\s*\n/g,"\n").trim(),n[k]={role:"ai",text:y,think:f},d.value[e]=[...n],f&&(p.value[e][k]=!0),e===t.value&&(v.value=[...n],u.value=!1,l.value="",w()),await m()}catch(i){const a=n.length-1;n[a]={role:"ai",text:"[AI流式异常] "+i.message,think:""},d.value[e]=[...n],e===t.value&&(v.value=[...n],w())}finally{k.value[e]=!1,g.value[e]="",e===t.value&&(s.value=!1,l.value="",u.value=!1,o.value=!1,c.value="",r.value=!0)}},I=e=>{const a=t.value;p.value[a]||(p.value[a]={}),void 0===p.value[a][e]&&(p.value[a][e]=!0),p.value[a][e]=!p.value[a][e],i.value=p.value[a]},R=()=>{r.value=!r.value},E=e=>{if("Enter"===e.key){if(e.shiftKey)return;e.preventDefault(),T()}},S=e=>{const t=e.target;t.style.height="auto",t.style.height=t.scrollHeight+"px"};return(0,n.sV)(async()=>{await m(),t.value&&await f(t.value),w()}),(0,n.wB)(t,async e=>{e&&(d.value[e]?(v.value=d.value[e],i.value=p.value[e]||{},w()):await f(e))}),{chatList:e,currentChatId:t,currentMessages:v,input:a,send:T,newChat:y,switchChat:C,loading:s,streamingText:l,thinkStates:i,toggleThink:I,isThinking:u,thinkingContent:c,showThinkingContent:r,toggleThinkingState:R,autoResizeInput:S,formatTime:b,formatResponse:x,isHeaderCollapsed:h,toggleHeader:L,handleKeydown:E}}},U=a(1241);const V=(0,U.A)(G,[["render",z],["__scopeId","data-v-01f43648"]]);var $=V}}]);
//# sourceMappingURL=641.fb1ffb6c.js.map