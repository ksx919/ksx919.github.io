"use strict";(self["webpackChunkaihub"]=self["webpackChunkaihub"]||[]).push([[225],{8225:function(s,t,e){e.r(t),e.d(t,{default:function(){return K}});var a=e(6768),i=e(4232),n=e(5130);const r={class:"negotiator-simulator"},l={key:0,class:"intro-section"},d={class:"start-btn-row"},o={key:1,class:"game-container"},c=["title"],u={class:"game-status"},h={class:"trust-value"},p={class:"trust-num"},v={class:"trust-bar-bg"},m={class:"timer"},g={class:"timer-num"},f={class:"round-info"},k={class:"round-num"},L={class:"game-dialog"},I={class:"messages"},y={class:"message-content"},w={key:0},C={class:"status-tag"},b={class:"message-text"},T={class:"score-info"},A={key:1},E={class:"input-area"},_=["disabled"],H=["disabled"];function M(s,t,e,M,F,S){return(0,a.uX)(),(0,a.CE)("div",r,[F.gameStarted?((0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",{class:(0,i.C4)(["game-header",{collapsed:F.isHeaderCollapsed}])},[t[7]||(t[7]=(0,a.Fv)('<div class="header-content" data-v-9886f148><h1 data-v-9886f148>谈判专家模拟器</h1><div class="features" data-v-9886f148><span class="feature-tag" data-v-9886f148>心理博弈</span><span class="feature-tag" data-v-9886f148>危机处理</span><span class="feature-tag" data-v-9886f148>话术技巧</span><span class="feature-tag" data-v-9886f148>人质解救</span></div></div>',1)),(0,a.Lk)("button",{class:"collapse-btn",onClick:t[1]||(t[1]=(...s)=>S.toggleHeader&&S.toggleHeader(...s)),title:F.isHeaderCollapsed?"展开标题":"收起标题"},(0,i.v_)(F.isHeaderCollapsed?"▼":"▲"),9,c)],2),(0,a.Lk)("div",u,[(0,a.Lk)("div",h,[t[9]||(t[9]=(0,a.eW)(" 信任值: ")),(0,a.Lk)("span",{class:(0,i.C4)(S.getTrustLevelClass())},[(0,a.Lk)("span",p,(0,i.v_)(F.trustValue),1),t[8]||(t[8]=(0,a.eW)("/100 "))],2),(0,a.Lk)("div",v,[(0,a.Lk)("div",{class:"trust-bar",style:(0,i.Tr)({width:F.trustValue+"%"})},null,4)])]),(0,a.Lk)("div",m,[t[11]||(t[11]=(0,a.eW)(" 剩余时间: ")),(0,a.Lk)("span",{class:(0,i.C4)({"time-warning":F.timeLeft<10})},[(0,a.Lk)("span",g,(0,i.v_)(F.timeLeft),1),t[10]||(t[10]=(0,a.eW)("s "))],2)]),(0,a.Lk)("div",f,[t[12]||(t[12]=(0,a.eW)(" 剩余轮数: ")),(0,a.Lk)("span",k,(0,i.v_)(F.roundsLeft),1)])]),(0,a.Lk)("div",L,[(0,a.Lk)("div",I,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(F.messages,(s,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:(0,i.C4)(["message",s.type])},[(0,a.Lk)("div",{class:(0,i.C4)(["bubble-wrapper",s.type])},[(0,a.Lk)("div",{class:(0,i.C4)(["bubble-triangle",s.type])},null,2),(0,a.Lk)("div",y,["ai"===s.type?((0,a.uX)(),(0,a.CE)("div",w,[(0,a.Lk)("span",C,(0,i.v_)(S.getAiStatus(s.content)),1),(0,a.Lk)("div",b,(0,i.v_)(S.getAiMessage(s.content)),1),(0,a.Lk)("div",T,(0,i.v_)(S.getScoreInfo(s.content)),1)])):((0,a.uX)(),(0,a.CE)("div",A,(0,i.v_)(s.content),1))])],2)],2))),128))])]),(0,a.Lk)("div",E,[(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>F.userInput=s),onInput:t[3]||(t[3]=(...s)=>S.autoResizeInput&&S.autoResizeInput(...s)),onKeydown:t[4]||(t[4]=(...s)=>S.handleKeydown&&S.handleKeydown(...s)),disabled:F.waitingForAI||F.timeLeft<=0,placeholder:"输入消息或指令 (/hint, /score)...",class:"message-input textarea-auto",rows:"1",style:{resize:"none",overflow:"hidden"}},null,40,_),[[n.Jo,F.userInput]]),(0,a.Lk)("button",{onClick:t[5]||(t[5]=s=>S.sendMessage()),disabled:F.waitingForAI||F.timeLeft<=0,class:"send-btn"}," 发送 ",8,H)])])):((0,a.uX)(),(0,a.CE)("div",l,[t[6]||(t[6]=(0,a.Fv)('<div class="intro-header" data-v-9886f148><h2 class="sim-title" data-v-9886f148>谈判专家模拟器</h2><div class="features" data-v-9886f148><span class="feature-tag" data-v-9886f148>心理博弈</span><span class="feature-tag" data-v-9886f148>危机处理</span><span class="feature-tag" data-v-9886f148>话术技巧</span><span class="feature-tag" data-v-9886f148>人质解救</span></div></div><div class="sim-desc" data-v-9886f148>你将扮演警方谈判专家，与AI扮演的劫持犯展开10轮心理博弈，通过话术提升信任值、挖掘诉求、化解危机，最终解救人质！</div><div class="intro-card" data-v-9886f148><ul data-v-9886f148><li data-v-9886f148><span class="li-dot" data-v-9886f148></span>目标：10轮内将信任值提升至100，解救人质</li><li data-v-9886f148><span class="li-dot" data-v-9886f148></span>信任值：初始20/100，≥60可合作，≤30有威胁</li><li data-v-9886f148><span class="li-dot" data-v-9886f148></span>每轮限时60秒，超时扣分</li><li data-v-9886f148><span class="li-dot" data-v-9886f148></span>可用指令：<span class="cmd" data-v-9886f148>/hint</span>（获取线索），<span class="cmd" data-v-9886f148>/score</span>（查看分数）</li><li data-v-9886f148><span class="li-dot" data-v-9886f148></span>高压事件：第3/6/9轮自动触发危机</li><li data-v-9886f148><span class="li-dot" data-v-9886f148></span>多结局分支，体验真实谈判挑战！</li></ul></div>',3)),(0,a.Lk)("div",d,[(0,a.Lk)("button",{class:"start-btn",onClick:t[0]||(t[0]=(...s)=>S.startGame&&S.startGame(...s))},"开始游戏")])]))])}e(4114);var F=e(4373),S={name:"NegotiatorSimulator",data(){return{gameStarted:!1,trustValue:20,timeLeft:60,roundsLeft:10,messages:[],userInput:"",waitingForAI:!1,timer:null,chatId:"game_"+Date.now(),sessionMessages:{},sessionLoading:{},currentChatId:"",isHeaderCollapsed:!1}},methods:{startGame(){this.gameStarted=!0,this.currentChatId=this.chatId,this.sendMessage("开始游戏")},toggleHeader(){this.isHeaderCollapsed=!this.isHeaderCollapsed},async sendMessage(s){let t="";if("string"===typeof s)t=s;else if(t=this.userInput,s&&s instanceof KeyboardEvent&&(s.preventDefault(),"keyup"===s.type&&"Enter"!==s.key))return;if(t.trim()&&!this.waitingForAI){this.messages.push({type:"user",content:t}),this.userInput="",this.waitingForAI=!0,this.timer&&clearInterval(this.timer),this.$nextTick(()=>{this.scrollToBottom()});try{const s=F.A.getUri({url:"/ai/game",params:{prompt:t,chatId:this.chatId}}),e=await fetch(s);if(!e.ok)throw new Error("请求失败");if(!e.body)throw new Error("无流式响应");const a=e.body.getReader(),i=new TextDecoder("utf-8");let n="";this.messages.push({type:"ai",content:""});const r=this.messages.length-1;while(1){const{done:s,value:t}=await a.read();if(s)break;const e=i.decode(t,{stream:!0});n+=e,this.messages[r].content=n,this.sessionMessages[this.chatId]=[...this.messages],this.$nextTick(()=>{this.scrollToBottom()})}this.parseAIResponse(n),await this.fetchChatList()}catch(e){this.messages.push({type:"ai",content:`[AI异常] ${e.message||"未知错误"}`}),this.sessionMessages[this.chatId]=[...this.messages]}finally{this.sessionLoading[this.chatId]=!1,this.waitingForAI=!1,this.resetTimer()}}},parseAIResponse(s){const t=s.match(/信任值[:：]\s*(\d+)\/100/);t&&(this.trustValue=parseInt(t[1]));const e=s.match(/剩余轮数[:：]\s*(\d+)/);e&&(this.roundsLeft=parseInt(e[1])),this.trustValue>=100&&this.$nextTick(()=>{window.confirm("恭喜你，信任值已达100，游戏胜利！\n点击确定返回首页。")&&this.resetGame()})},getTrustLevelClass(){return this.trustValue<=30?"trust-low":this.trustValue>=60?"trust-high":"trust-medium"},getAiStatus(s){const t=s.match(/\(([^)]+)\)/);return t?t[1]:""},getAiMessage(s){return s.replace(/\([^)]+\)/,"").split("\n")[0].trim()},getScoreInfo(s){const t=s.split("\n");return t.slice(1).join("\n")},resetTimer(){this.timer&&clearInterval(this.timer),this.timeLeft=60,this.startTimer()},startTimer(){this.timer=setInterval(()=>{this.timeLeft--,this.timeLeft<=0&&(clearInterval(this.timer),this.handleTimeout())},1e3)},handleTimeout(){this.messages.push({type:"ai",content:"(超时)"}),this.timeLeft=0,this.sendMessage("(超时)")},async fetchChatList(){return Promise.resolve()},resetGame(){this.gameStarted=!1,this.trustValue=20,this.timeLeft=60,this.roundsLeft=10,this.messages=[],this.userInput="",this.waitingForAI=!1,this.timer=null,this.chatId="game_"+Date.now(),this.sessionMessages={},this.sessionLoading={},this.currentChatId=""},handleKeydown(s){if("Enter"===s.key){if(s.shiftKey)return;s.preventDefault(),this.sendMessage()}},autoResizeInput(s){const t=s.target;t.style.height="auto",t.style.height=t.scrollHeight+"px"},scrollToBottom(){this.$nextTick(()=>{const s=this.$el.querySelector(".messages");s&&(s.scrollTop=s.scrollHeight)})}},beforeUnmount(){this.timer&&clearInterval(this.timer)}},x=e(1241);const V=(0,x.A)(S,[["render",M],["__scopeId","data-v-9886f148"]]);var K=V}}]);
//# sourceMappingURL=225.b80eb5e2.js.map