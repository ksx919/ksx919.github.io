"use strict";(self["webpackChunkaihub"]=self["webpackChunkaihub"]||[]).push([[562],{8562:function(e,a,t){t.r(a),t.d(a,{default:function(){return j}});var l=t(6768),s=t(4232),n=t(5130);const u={class:"chat-pdf-layout"},c={class:"sidebar"},r={class:"chat-list"},i=["onClick"],o={class:"chat-summary"},d={class:"chat-time"},v={class:"chat-main"},p=["title"],h={key:0,class:"content-area"},f={class:"pdf-viewer-container"},m=["src"],k={class:"chat-window"},y={class:"chat-history-area"},g={class:"messages"},w={class:"message-avatar"},b={key:0,class:"user-avatar"},L={key:1,class:"ai-avatar"},C={class:"message-content"},D={key:0,class:"user-message"},I={class:"text"},E={key:0,class:"loading-dots"},F={key:1,class:"ai-response"},R=["innerHTML"],K={class:"input-bar-container"},x={class:"input-wrapper"},T=["disabled"],P={class:"input-actions"},U=["disabled"],X={key:0},$={key:1},H={key:1,class:"pdf-upload-area"};function A(e,a,t,A,_,M){return(0,l.uX)(),(0,l.CE)("div",u,[(0,l.Lk)("aside",c,[a[8]||(a[8]=(0,l.Lk)("div",{class:"sidebar-header"},[(0,l.Lk)("h2",null,"PDF聊天"),(0,l.Lk)("p",{class:"subtitle"},"智能文档助手")],-1)),(0,l.Lk)("div",r,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(A.chatList,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.chatId,class:(0,s.C4)(["chat-item",e.chatId===A.currentChatId?"active":""]),onClick:a=>A.switchChat(e.chatId)},[(0,l.Lk)("div",o,(0,s.v_)(e.summary||"（空会话）"),1),(0,l.Lk)("div",d,(0,s.v_)(A.formatTime(e.createTime)),1)],10,i))),128))]),(0,l.Lk)("button",{class:"new-chat-btn",onClick:a[0]||(a[0]=(...e)=>A.newChat&&A.newChat(...e))},"+ 新建会话")]),(0,l.Lk)("main",v,[(0,l.Lk)("div",{class:(0,s.C4)(["chat-header",{collapsed:A.isHeaderCollapsed}])},[a[9]||(a[9]=(0,l.Fv)('<div class="header-content" data-v-96ab436c><h1 data-v-96ab436c>PDF智能助手</h1><div class="features" data-v-96ab436c><span class="feature-tag" data-v-96ab436c>文档解析</span><span class="feature-tag" data-v-96ab436c>内容问答</span><span class="feature-tag" data-v-96ab436c>要点提取</span><span class="feature-tag" data-v-96ab436c>智能总结</span></div></div>',1)),(0,l.Lk)("button",{class:"collapse-btn",onClick:a[1]||(a[1]=(...e)=>A.toggleHeader&&A.toggleHeader(...e)),title:A.isHeaderCollapsed?"展开标题":"收起标题"},(0,s.v_)(A.isHeaderCollapsed?"▼":"▲"),9,p)],2),A.pdfUrl?((0,l.uX)(),(0,l.CE)("div",h,[(0,l.Lk)("div",f,[(0,l.Lk)("iframe",{src:A.pdfUrl,class:"pdf-viewer",frameborder:"0"},null,8,m)]),(0,l.Lk)("div",k,[(0,l.Lk)("div",y,[(0,l.Lk)("div",g,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(A.currentMessages,(e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:(0,s.C4)(["message",e.role])},[(0,l.Lk)("div",w,["user"===e.role?((0,l.uX)(),(0,l.CE)("div",b,"👤")):((0,l.uX)(),(0,l.CE)("div",L,"🤖"))]),(0,l.Lk)("div",C,["user"===e.role?((0,l.uX)(),(0,l.CE)("div",D,[(0,l.Lk)("span",I,(0,s.v_)(e.text),1)])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[A.loading&&t===A.currentMessages.length-1&&!e.text?((0,l.uX)(),(0,l.CE)("div",E,a[10]||(a[10]=[(0,l.Lk)("span",{class:"dot"},null,-1),(0,l.Lk)("span",{class:"dot"},null,-1),(0,l.Lk)("span",{class:"dot"},null,-1)]))):(0,l.Q3)("",!0),e.text?((0,l.uX)(),(0,l.CE)("div",F,[(0,l.Lk)("div",{class:"response-text",innerHTML:A.formatResponse(e.text)},null,8,R)])):(0,l.Q3)("",!0)],64))])],2))),128))])]),(0,l.Lk)("div",K,[(0,l.Lk)("div",x,[(0,l.bo)((0,l.Lk)("textarea",{"onUpdate:modelValue":a[2]||(a[2]=e=>A.input=e),onInput:a[3]||(a[3]=(...e)=>A.autoResizeInput&&A.autoResizeInput(...e)),onKeydown:a[4]||(a[4]=(...e)=>A.handleKeydown&&A.handleKeydown(...e)),placeholder:"请输入您的问题...",disabled:A.loading||!A.pdfUrl,class:"chat-input textarea-auto",rows:"1",style:{resize:"none",overflow:"hidden"}},null,40,T),[[n.Jo,A.input]]),(0,l.Lk)("div",P,[(0,l.Lk)("button",{onClick:a[5]||(a[5]=(...e)=>A.send&&A.send(...e)),disabled:A.loading||!A.pdfUrl||!A.input.trim(),class:"send-btn"},[A.loading?((0,l.uX)(),(0,l.CE)("span",X,"发送中...")):((0,l.uX)(),(0,l.CE)("span",$,"发送"))],8,U)])])])])])):(0,l.Q3)("",!0),A.pdfUrl?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",H,[(0,l.Lk)("div",{class:"upload-placeholder",onClick:a[6]||(a[6]=a=>e.$refs.fileInput.click())},a[11]||(a[11]=[(0,l.Lk)("p",null,"点击上传PDF文件",-1),(0,l.Lk)("p",{class:"upload-hint"},"支持PDF格式文件",-1)])),(0,l.Lk)("input",{type:"file",ref:"fileInput",onChange:a[7]||(a[7]=(...e)=>A.handleFileUpload&&A.handleFileUpload(...e)),accept:".pdf",style:{display:"none"}},null,544)]))])])}t(4114),t(8111),t(116),t(1701);var _=t(144),M=t(4373);function z(){return"chat_"+Date.now()+"_"+Math.random().toString(36).slice(2,8)}var Q={name:"ChatPDF",setup(){const e=(0,_.KR)([]),a=(0,_.KR)(""),t=(0,_.KR)(""),s=(0,_.KR)(!1),n=(0,_.KR)([]),u=(0,_.KR)(""),c=(0,_.KR)(""),r=(0,_.KR)(!1),i=(0,_.KR)({}),o=(0,_.KR)({}),d=(0,_.KR)({}),v=async()=>{try{const l=await M.A.get("/ai/history/pdf/with-time"),s=l.data,n=[];for(const[e,a]of Object.entries(s))try{const t=`${M.A.defaults.baseURL}/ai/pdf/file/${e}`,l=await fetch(t,{method:"HEAD"});let s="（空会话）";l.ok&&(s=`PDF_${e.substring(0,8)}.pdf`),n.push({chatId:e,summary:s,createTime:a})}catch(t){n.push({chatId:e,summary:"（空会话）",createTime:a})}n.sort((e,a)=>a.createTime-e.createTime),e.value=n,e.value.length>0&&!a.value&&(a.value=e.value[0].chatId)}catch(t){console.error("获取会话列表失败:",t)}},p=async e=>{if(e)try{const l=await M.A.get(`/ai/history/pdf/${e}`),s=l.data.map(e=>"assistant"===e.role?{role:"ai",text:e.content}:{role:"user",text:e.content});i.value[e]=s,e===a.value&&(n.value=s,m());try{const t=`${M.A.defaults.baseURL}/ai/pdf/file/${e}`,l=await fetch(t,{method:"HEAD"});if(l.ok){const l={url:t,name:`PDF_${e.substring(0,8)}.pdf`};d.value[e]=l,e===a.value&&(u.value=l.url,c.value=l.name)}}catch(t){console.debug("检查PDF文件是否存在时出错:",t)}d.value[e]&&(u.value=d.value[e].url,c.value=d.value[e].name)}catch(l){console.error("获取消息失败:",l)}},h=async()=>{const e=z();a.value=e,i.value[e]=[],n.value=[],u.value="",c.value="",d.value[e]={url:"",name:""}},f=async t=>{if(a.value=t,i.value[t]){if(n.value=i.value[t],d.value[t])u.value=d.value[t].url,c.value=d.value[t].name;else try{const a=`${M.A.defaults.baseURL}/ai/pdf/file/${t}`,l=await fetch(a,{method:"HEAD"});if(l.ok){const l={url:a,name:`PDF_${t.substring(0,8)}.pdf`};d.value[t]=l,u.value=l.url,c.value=l.name;const s=e.value.find(e=>e.chatId===t);s&&(s.summary=l.name)}}catch(l){console.debug("检查PDF文件是否存在时出错:",l)}m()}else await p(t)},m=()=>{setTimeout(()=>{const e=document.querySelector(".messages");e&&(e.scrollTop=e.scrollHeight)},10)},k=e=>{if(e){const a=new Date(e);return a.toLocaleDateString()+" "+a.toLocaleTimeString()}return""},y=e=>e?e.replace(/\n/g,"<br>"):"",g=()=>{r.value=!r.value},w=async t=>{a.value||await h();const l=t.target.files[0];if(!l||"application/pdf"!==l.type)return void alert("请选择PDF文件");const s=104857600;if(l.size>s)return alert("文件大小不能超过100MB"),void(t.target.value="");const n=new FormData;n.append("file",l);try{const s=await M.A.post(`/ai/pdf/upload/${a.value}`,n,{headers:{"Content-Type":"multipart/form-data"}});if(1!==s.data.ok)throw new Error(s.data.msg||"上传失败");const r=a.value,i={url:`${M.A.defaults.baseURL}/ai/pdf/file/${r}`,name:l.name};d.value[r]=i,u.value=i.url,c.value=i.name;const o=e.value.find(e=>e.chatId===r);o&&(o.summary=l.name),t.target.value=""}catch(r){console.error("上传PDF失败:",r),alert("上传PDF失败，请重试")}},b=()=>{u.value="",c.value="";const t=a.value;if(d.value[t]){d.value[t]={url:"",name:""};const a=e.value.find(e=>e.chatId===t);a&&(a.summary="（空会话）")}},L=async()=>{if(!t.value.trim()||s.value||!u.value)return;const l=a.value,c=t.value;t.value="",o.value[l]=!0,s.value=!0;let r=i.value[l]||[];if(0===r.length){const a=Date.now();e.value.unshift({chatId:l,summary:c.slice(0,20)+(c.length>20?"...":""),createTime:a})}else{const a=e.value.find(e=>e.chatId===l);a&&(a.createTime=Date.now())}r.push({role:"user",text:c}),i.value[l]=r,r.push({role:"ai",text:""}),i.value[l]=r,l===a.value&&(n.value=r,m()),C(l,c,r)},C=async(e,t,l)=>{try{const s=M.A.getUri({url:"/ai/pdf/chat",params:{prompt:t,chatId:e}}),u=await fetch(s);if(!u.body)throw new Error("无流式响应");const c=u.body.getReader(),r=new TextDecoder("utf-8");let o="";const d=l.length-1;while(1){const{done:t,value:s}=await c.read();if(t)break;const u=r.decode(s,{stream:!0});o+=u,l[d].text=o,i.value[e]=[...l],e===a.value&&(n.value=[...l],m())}await v()}catch(u){const t=l.length-1;l[t]={role:"ai",text:`[AI异常] ${u.message||"未知错误"}`},i.value[e]=[...l],e===a.value&&(n.value=[...l],m())}finally{o.value[e]=!1,e===a.value&&(s.value=!1)}},D=e=>{if("Enter"===e.key){if(e.shiftKey)return;e.preventDefault(),L()}},I=e=>{const a=e.target;a.style.height="auto",a.style.height=a.scrollHeight+"px"};return(0,l.sV)(async()=>{await v(),a.value&&await p(a.value)}),{chatList:e,currentChatId:a,currentMessages:n,input:t,send:L,newChat:h,switchChat:f,loading:s,pdfUrl:u,currentPdfName:c,handleFileUpload:w,closePdf:b,autoResizeInput:I,formatTime:k,formatResponse:y,isHeaderCollapsed:r,toggleHeader:g,handleKeydown:D}}},S=t(1241);const V=(0,S.A)(Q,[["render",A],["__scopeId","data-v-96ab436c"]]);var j=V}}]);
//# sourceMappingURL=562.49e838f7.js.map